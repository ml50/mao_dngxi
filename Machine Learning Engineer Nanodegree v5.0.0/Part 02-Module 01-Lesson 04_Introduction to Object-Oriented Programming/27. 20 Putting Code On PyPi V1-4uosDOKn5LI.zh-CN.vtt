WEBVTT
Kind: captions
Language: zh-CN

00:00:00.000 --> 00:00:02.279
PyPI 也被称为

00:00:02.279 --> 00:00:08.400
Python Package Index (Python 软件包索引) 是 Python 软件包的存储库

00:00:08.400 --> 00:00:14.289
当你 pip install 软件包时 会从 PyPI 上下载文件并安装

00:00:14.289 --> 00:00:17.044
所有人都可以向 PyPI 上传软件包

00:00:17.045 --> 00:00:20.015
我将展示一下上传软件包的基本操作

00:00:20.015 --> 00:00:26.625
PyPI 网站除了常规的存储库 实际上还有一个测试存储库

00:00:26.625 --> 00:00:29.490
这是测试存储库的网站

00:00:29.489 --> 00:00:32.460
我建议先将软件包上传到测试存储库

00:00:32.460 --> 00:00:35.399
确保所有内容都符合预期之后

00:00:35.399 --> 00:00:42.070
再将软件包上传到这个网站上的常规存储库

00:00:42.070 --> 00:00:44.840
请记住 如果软件包在常规存储库中

00:00:44.840 --> 00:00:48.365
所有人都可以下载安装

00:00:48.365 --> 00:00:54.765
第一步是分别在 PyPI 和 TestPyPI 存储库中创建账号

00:00:54.765 --> 00:00:56.810
进入到每个网站

00:00:56.810 --> 00:01:00.490
你可以点击 Register (注册) 来创建账号

00:01:00.490 --> 00:01:03.910
我已经创建过了 所以跳过这个步骤

00:01:03.909 --> 00:01:09.649
接下来 进入你的终端 输入你的软件包文件所在目录

00:01:09.650 --> 00:01:15.844
我们来打开 dsnd_probability 文件夹 也就是软件包所在目录

00:01:15.844 --> 00:01:19.670
你会看到多了一些额外的文件

00:01:19.670 --> 00:01:23.590
除了之前在软件包中编写的文件

00:01:23.590 --> 00:01:26.505
你需要添加这些额外的文件

00:01:26.504 --> 00:01:30.949
第一个是 license.txt 文件

00:01:30.950 --> 00:01:35.090
打开这个文件 其中存放了版权信息

00:01:35.090 --> 00:01:38.659
我使用的是从 openource.org 网站复制和粘贴的 MIT 许可证

00:01:38.659 --> 00:01:42.265
我使用的是从 openource.org 网站复制和粘贴的 MIT 许可证

00:01:42.265 --> 00:01:46.590
接下来 你还需要添加一个 README.md 文件

00:01:46.590 --> 00:01:49.490
我还没有在其中补充足够的详细信息

00:01:49.489 --> 00:01:53.489
你需要在其中介绍软件包的功能

00:01:53.489 --> 00:01:57.324
最后创建一个 setup.cfg 文件

00:01:57.325 --> 00:02:01.909
你需要在此处输入的是有关 README 文件名称的数据

00:02:01.909 --> 00:02:06.545
返回上一级目录 打开 setup.py 文件

00:02:06.545 --> 00:02:11.754
你可以看到我的软件包命名是 dsnd_probability

00:02:11.754 --> 00:02:17.414
包含软件包所有文件的文件夹名称也是 dsnd_probability

00:02:17.414 --> 00:02:20.709
如果你想要将这些代码上传到 PyPI

00:02:20.710 --> 00:02:23.159
你需要想一个别的名字

00:02:23.159 --> 00:02:27.125
PyPI 的每个软件包都要有一个独一无二的名称

00:02:27.125 --> 00:02:29.270
在 setup.py 文件中

00:02:29.270 --> 00:02:34.110
package 变量需要使用 name 变量一样的名称

00:02:34.110 --> 00:02:37.390
我将 zip_safe 设置为 False

00:02:37.389 --> 00:02:41.569
这意味着无法从 zip 文件中直接运行软件包

00:02:41.569 --> 00:02:44.799
如果你的软件包依赖需要解压缩

00:02:44.800 --> 00:02:49.265
才能使用的数据文件 这一点尤为重要

00:02:49.264 --> 00:02:51.859
再次注意 我更改了

00:02:51.860 --> 00:02:56.540
软件包文件夹的名称以匹配 dsnd_probability

00:02:56.539 --> 00:02:59.379
我在这里的解释比较简略

00:02:59.379 --> 00:03:02.579
不过如果你想要了解更多关于如何上传到 PyPI 的内容

00:03:02.580 --> 00:03:05.285
可以参考下方的文档链接

00:03:05.284 --> 00:03:08.419
打开你的终端 确保终端处于

00:03:08.419 --> 00:03:12.089
软件包文件所在目录下

00:03:12.090 --> 00:03:16.995
输入 python setup.py sdist

00:03:16.995 --> 00:03:19.865
如果查看软件包文件夹

00:03:19.865 --> 00:03:23.150
会看到现在出现了几个新的文件夹

00:03:23.150 --> 00:03:26.450
在 dist 文件夹中是一个 tar.gz 文件

00:03:26.449 --> 00:03:30.694
最终会上传到 PyPI 存储库

00:03:30.694 --> 00:03:36.753
接下来 返回终端使用 pip install twine 安装 twine 软件包

00:03:36.753 --> 00:03:40.370
输入以下命令

00:03:40.370 --> 00:03:44.849
将软件包上传到 PyPI 测试存储库

00:03:44.849 --> 00:03:49.109
twine upload --repository-url https://test.pypi.org/legacy/ dist/*

00:03:49.110 --> 00:04:01.885
twine upload --repository-url https://test.pypi.org/legacy/ dist/*

00:04:01.884 --> 00:04:05.039
就是这样 点击回车

00:04:05.039 --> 00:04:06.804
这是我的用户名

00:04:06.805 --> 00:04:12.525
TestPyPI 存储库的用户名 以及我的密码

00:04:12.525 --> 00:04:17.954
出现了一个报错 提示我上传的版本号跟之前的版本一样

00:04:17.954 --> 00:04:23.524
所以我需要把 1.2 修改为 1.3

00:04:23.524 --> 00:04:29.264
你有可能也会遇到这样的报错 需要做相同的操作

00:04:29.264 --> 00:04:34.419
这是因为我已经尝试上传过相同的版本

00:04:34.420 --> 00:04:36.620
所以我要回到上一层

00:04:36.620 --> 00:04:41.269
删除 dist 文件夹和之前创建的额外的 info 文件夹

00:04:41.269 --> 00:04:49.799
然后重复之前相同的步骤 python setup.py sdist

00:04:49.959 --> 00:04:57.689
再次尝试 twine upload --repository-url

00:04:58.240 --> 00:05:02.350
输入我的用户名密码

00:05:02.350 --> 00:05:04.285
这次看起来成功了

00:05:04.285 --> 00:05:07.220
我要去 TestPyPI 网站看一下

00:05:07.220 --> 00:05:13.790
登录我的账号 看起来都上传好了

00:05:13.790 --> 00:05:16.185
再回到终端看一下

00:05:16.185 --> 00:05:19.514
现在我就可以使用 pip 安装这个包了

00:05:19.514 --> 00:05:25.110
输入以下命令 pip install --index-url

00:05:34.160 --> 00:05:37.450
https://test.pypi.org/simple dsnd_probability.

00:05:37.449 --> 00:05:42.300
这个命令是使用 pip 从测试存储库中安装软件包

00:05:42.300 --> 00:05:46.675
看起来安装成功了

00:05:46.675 --> 00:05:50.050
假设一切顺利

00:05:50.050 --> 00:05:53.435
你已经准备好将包上传到常规的 PyPI 存储库

00:05:53.435 --> 00:05:55.144
以下是操作流程

00:05:55.144 --> 00:05:59.649
输入 twine upload dist/*

00:06:00.089 --> 00:06:04.614
输入你的用户名 密码

00:06:04.615 --> 00:06:09.600
现在检查一下常规的 PyPI 存储库网站上是否完全上传

00:06:09.600 --> 00:06:14.840
登陆一下 看起来都上传成功了

00:06:14.839 --> 00:06:18.709
注意 我们已经在 test 网站上安装过这个包了

00:06:18.709 --> 00:06:20.759
所以我要先卸载

00:06:20.759 --> 00:06:24.490
因为这个软件包已经在常规存储库中了

00:06:24.490 --> 00:06:26.030
我可以直接 pip install

00:06:26.029 --> 00:06:30.354
只需要输入 pip install 加上软件包名称

00:06:30.355 --> 00:06:33.395
看起来都正确安装了

00:06:33.394 --> 00:06:37.995
现在我要看看 Python 程序中是否可以使用

00:06:37.995 --> 00:06:43.189
打开一个新的终端窗口 进入 Python 解释器

00:06:43.189 --> 00:06:46.129
现在输入 from dsnd_probability import Gaussian, Binomial

00:06:46.129 --> 00:06:55.264
现在输入 from dsnd_probability import Gaussian, Binomial

00:06:55.264 --> 00:07:02.389
现在一切顺利 输入 Gaussian(10,7)

00:07:02.389 --> 00:07:08.935
点击回车 然后代码就创建了一个均值为 10 标准偏差为 7 的 Gaussian 对象

00:07:08.935 --> 00:07:13.730
如果我输入 Binomial(0.4, 25)

00:07:13.730 --> 00:07:17.439
点击回车就显示出了均值、标准偏差、

00:07:17.439 --> 00:07:20.509
概率和样本数量

00:07:20.509 --> 00:07:22.569
看起来代码可以正常运行

00:07:22.569 --> 00:07:27.954
目前展示的是使用 PyPI 设置并运行的基础操作

00:07:27.954 --> 00:07:31.699
如果你要上传这节课上构建的软件包

00:07:31.699 --> 00:07:37.094
确保你使用的是与 dsnd_probability 不同的名称

00:07:37.095 --> 00:07:39.995
否则不能成功上传

00:07:39.995 --> 00:07:43.189
因为会跟我刚刚上传的包名产生冲突

00:07:43.189 --> 00:07:46.615
另外 注意一下软件包名中我使用的是下划线 _

00:07:46.615 --> 00:07:52.490
但是返回到 PyPI 网站上 名称会变成短横线 -

00:07:52.490 --> 00:07:54.600
这也是需要注意的内容

00:07:54.600 --> 00:07:56.260
当使用 pip 安装的时候

00:07:56.259 --> 00:07:57.754
你需要使用短横线 -

00:07:57.754 --> 00:08:03.444
但是 当你在 Python 解释器或程序中使用该包的时候

00:08:03.444 --> 00:08:05.680
你要使用下划线

00:08:05.680 --> 00:08:07.939
现在轮到你了

00:08:07.939 --> 00:08:13.469
跟随视频中的指导说明 尝试将你自己的软件包上传到 PyPI 上

